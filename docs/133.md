# API 可观察性和 API 监控之间有什么区别

> 原文：<https://www.moesif.com/blog/api-engineering/api-observability/What-is-the-Difference-Between-API-Observability-vs-API-Monitoring/>

API 监控的传统定义在 SmartBear、APIMetrics 和 Runscope 等公司已经存在多年，对于检查 API 的正确性和性能非常有用。API 监控工具针对您选择的端点启动 API 调用，然后记录收到的响应。可以添加额外的检查，例如在 500 错误或超时时创建松弛警报。测试可以在触发时启动(例如当您的 CI/CD 管道部署了新版本时)，也可以按循环时间表启动(例如每 1 分钟)。API 监控测试可以是简单的，比如简单的健康和正常运行时间检查，也可以是非常复杂的，通过一长串 API 调用运行，并检查特定的状态代码、主体字段等等。

虽然 API 监控使您能够检查正常运行时间，并在 API 超时或响应 500 个错误时采取措施，但它也有局限性，因为它是一种*黑盒*形式的监控，具有提前创建的断言检查。测试或探测已经提前知道，这意味着 API 监控无法回答关于*你的 API 如何*运行的任意问题。相反，API 监控只能检查它生成的流量，而不是实际的客户 API 流量。随着越来越多的 API 暴露在互联网上，有了新的需求来探索和发现未知的未知，以防止 API 威胁，解决客户问题，并了解 API 的使用。这些需求导致了 *API 可观察性*的出现。

与黑盒测试和监控不同，API 可观察性是一种形式的*白盒*监控，需要代理或 SDK 被动地将 API 流量记录到可观察性服务中。这种数据收集可以在应用程序中完成，也可以添加一个不同的点，例如使用像 Kong 或 NGINX 这样的 API 网关。

## API 可观察性的用例

### 监控客户体验

API 可观察性可以跟踪用户或客户与您的 API 的每一次交互，这使您能够描绘不同的端到端流，并了解热点可能存在于何处。大多数提供 API 的团队不能完全控制他们的消费者如何使用 API。这些消费者可能来自一个大型组织的另一个部门或产品，也可能来自不同的公司。作为开发人员，我们喜欢*假设*客户会以特定的方式使用我们的产品，但是 API 集成工作可能会很混乱或者充满错误。例如，您的 API 消费者可能会忽略您关于分页和过滤的建议，从而导致过多的数据被轮询。API 可观察性的目标是主动发现这些未知的未知，并补救它们，无论是您自己的代码还是 API 消费者的代码有问题。

### API 问题疑难解答

因为 API 可观察性工具记录了 API 上发生的所有事情，所以您能够探索未知的未知情况，例如客户可能遇到的您以前从未见过的问题。您不需要提前创建一个测试来观察发生了什么。会出现各种各样的 API 问题，有些问题比较容易调查，比如缺少 API 键或 HTTP 头，但其他问题可能要复杂得多，需要跟踪 API 调用的历史和它们的计时。

### 检测并防范 API 威胁

一个设计良好的 API 可观察性平台不仅可以跟踪 API 上发生的事情，还可以跟踪谁在发出 API 请求，从而实现复杂的用户行为分析(UBA)以及用户和实体行为分析(UEBA)。通过跟踪复杂的用户流，您可以识别可能抓取您的 API 或访问未授权数据的可疑用户。

不像 web 应用程序可以结合像 Capctha 和浏览器指纹这样的技术，API 公开了对数据的原始访问。一些 API 甚至可能让客户以编程方式访问，这使得区分真正的 API 调用和恶意的 API 调用变得极其困难。这使得传统的基于规则的 Web 应用防火墙(WAF)如 ModSecurity 对 API 无用。相反，采用以用户为中心的方法的现代 API 可观测性解决方案可以使用高级异常检测来检测未知的未知。

### 了解客户 API 的使用

组织构建 API 是为了给 API 的客户或用户创造有价值的东西，而不仅仅是为了构建东西。与 API 安全性一样，这需要一种机制来将 API 调用归因于个人客户及其收入，并且是 API 的用户行为分析(UBA)的另一个用例。寻找 API 分析的常见团队包括产品组织，但也包括跟踪试点使用、试验和扩展机会的销售和增长团队。直到 2015 年，Twilio 的估值才达到 5 亿美元。据 Akamai 称，现在它是一家价值 300 亿美元的公司，所有 HTTP 流量的 83%来自 API 调用。API 不再仅仅是一种“后端技术”，而是一种关键的业务驱动力。

然而，API 调用只讲述了故事的一半(参与)，一个好的 API 可观察性工具还提供了存储客户人口统计和收入(用于货币化和细分)的能力，以及跟踪 API 外部发生的事情，如注册和计划购买。

## API 可观察性的支柱

### API 指标

API 指标使您能够监控工程和业务 KPI，例如性能和客户使用情况。一些指标跟踪工具只能监控单值指标，如每分钟请求数。然而，可观察性的一个关键主题是能够回答任何关于您的 API 和服务的问题，而无需提前计划哪些指标*需要*进行监控。在这种情况下，高基数、高维度的指标和数据存储可以方便地探索和回答未知的未知问题，并能够立即切片和切片。

![API Metrics](img/1f5a1d7df40bdee9162936f47b9c18f4.png)

### API 日志

像 API 度量一样，API 可观察性平台也能够实时检查 API 调用，以便进行调试和审计。API 日志向您显示即时的准确调用。因为根据定义，API 的结构不同于传统的日志记录，所以 API 日志还可以用于生成聚合和指标，同时维护上下文。然而，API 调用可以有大量的 HTTP 头、主体键和属性。这意味着您的 API 可观察性工具应该能够通过它们进行过滤和聚合，而不需要依赖于对数据存储的全面扫描(这可能需要很长时间)。

GDPR 和 CCPA 要求对 API 日志之类的东西采用新的程序，这些程序在整个公司从安全团队到业务团队都在使用。您不能再简单地将 API 日志转储到日志管理解决方案中。相反，API 企业需要一种方法来导出和删除(或匿名化)特定于单个客户的所有相关日志和事件。这意味着 API 日志必须绑定到某个永久的用户标识符上(而不仅仅是轮换的 API 键)。

![API Logs](img/3b19552ff953983231af1e85b9d352fa.png)

### API 分析

API 可观察性的第三个支柱是 API 分析。与侧重于回答工程特定问题的 API 度量和日志不同，API 分析侧重于回答产品和业务相关的问题。简单地说，API 分析是 API 指标与关于客户是谁以及他们如何使用您的 API 的数据的融合。很多时候，API 分析工具可以从 CRM 或营销自动化工具等其他系统中提取数据，以便您能够绘制出客户旅程。API 分析可以包括漏斗指标，如有多少人激活和使用您的 API，以了解哪些端点产生的收入或增长最多。

![API Analytics](img/5b616c584c814c89f01e5c3878e7b5a5.png)

### API 跟踪

由于本质上是事务性的，API 包含关于何时发起请求、服务需要多长时间响应等时间的计时信息。不同的计时会产生难以重现的竞争条件和错误。API 跟踪可以很容易地理解不同的服务需要多长时间来响应，以及哪里会出现计时错误。跟踪使您能够进一步探索特定会话或相关 API 调用集要查看的日志。

![API Traces](img/48e12e5cf2d514b4883d7d7d7d7035ea.png)

## 结束语

任何希望快速自信地发布 API 的人都应该寻找一个 API 可观察性系统。API 为您公司基础设施的其余部分提供了窗口，并实现了全新的数字体验，但传统的监控只能回答已知的问题，如“我的 API 是否停机了”，而不能回答数据驱动的工程和业务团队所需的任意问题，也不能报告安全性和产品分析所需的实际客户 API 使用情况。